--TEST--
Hash: serialize()/unserialize() with HASH_HMAC
--FILE--
<?php

$algos = hash_algos();
$non_crypto = ["adler32", "crc32", "crc32b", "crc32c", "fnv132", "fnv1a32", "fnv164", "fnv1a64", "joaat"];
$key = "This is the key that I have";

foreach ($algos as $algo) {
    if (in_array($algo, $non_crypto)) {
        continue;
    }

    var_dump($algo);
    $ctx0 = hash_init($algo, HASH_HMAC, $key);
    $serial = serialize($ctx0);
    assert(is_string($serial));

    $ctx1 = unserialize($serial);
    hash_update($ctx1, "I can't remember anything");
    $serial = serialize($ctx1);
    assert(is_string($serial));
    var_dump(hash_final($ctx1));

    $ctx2 = unserialize($serial);
    var_dump(hash_final($ctx2));
}

foreach ($algos as $algo) {
    if (in_array($algo, $non_crypto)) {
        continue;
    }

    var_dump($algo);
    $orig = hash_init($algo, HASH_HMAC, $key);
    hash_update($orig, "I can't remember anything");
    $serial = serialize($orig);

    $fresh = hash_init($algo, HASH_HMAC, $key);
    hash_update($fresh, "I can't remember anythingCan’t tell if this is true or dream");
    var_dump(hash_final($fresh));

    $copy = unserialize($serial);
    hash_update($copy, "Can’t tell if this is true or dream");
    var_dump(hash_final($copy));
}

echo "Done\n";
?>
--EXPECT--
string(3) "md2"
string(32) "4306a5c7b4644981d4e8c8ba2c221903"
string(32) "4306a5c7b4644981d4e8c8ba2c221903"
string(3) "md4"
string(32) "80ceb282b7e6e5c4994e6aa22382a08e"
string(32) "80ceb282b7e6e5c4994e6aa22382a08e"
string(3) "md5"
string(32) "41607973c8938c657e95edacb6bec637"
string(32) "41607973c8938c657e95edacb6bec637"
string(4) "sha1"
string(40) "5a4788201c0a37c2eeb8d69393a8c3c2559f150a"
string(40) "5a4788201c0a37c2eeb8d69393a8c3c2559f150a"
string(6) "sha224"
string(56) "ecf3494b1227c04c8412db84829cbc78f1f1988813d66eb77406df70"
string(56) "ecf3494b1227c04c8412db84829cbc78f1f1988813d66eb77406df70"
string(6) "sha256"
string(64) "8a1714e5b35473ec2a71da9fb5ef270a431aa944c872856ff350c548708a47bd"
string(64) "8a1714e5b35473ec2a71da9fb5ef270a431aa944c872856ff350c548708a47bd"
string(6) "sha384"
string(96) "8610cdabd1ef2d0ae694dd9015c4dc3b9c86bf7347e12a8c4257cd0b3cb2063fcba13437aade294e6220cef2c988b4a9"
string(96) "8610cdabd1ef2d0ae694dd9015c4dc3b9c86bf7347e12a8c4257cd0b3cb2063fcba13437aade294e6220cef2c988b4a9"
string(10) "sha512/224"
string(56) "42b6b7ad94b2444d035b22e8eb2863b39b71d48ab5268001672a0f8c"
string(56) "42b6b7ad94b2444d035b22e8eb2863b39b71d48ab5268001672a0f8c"
string(10) "sha512/256"
string(64) "103461bcdd3e037da9888779f96edcb7a393110ebf9ec6464a94f3d475d1a17c"
string(64) "103461bcdd3e037da9888779f96edcb7a393110ebf9ec6464a94f3d475d1a17c"
string(6) "sha512"
string(128) "b36b01506959ca1aa15284909556b284db0d70ed62ddf24c1e79bc55d02ce7196024efc3119188d36c1d60008aecbd2d7e8f0e12a9ef2f91e9b5d5413b08ac9b"
string(128) "b36b01506959ca1aa15284909556b284db0d70ed62ddf24c1e79bc55d02ce7196024efc3119188d36c1d60008aecbd2d7e8f0e12a9ef2f91e9b5d5413b08ac9b"
string(8) "sha3-224"
string(56) "eb2c1a0e913a3494461262f35a33c775bc781bf8493811498c98d928"
string(56) "eb2c1a0e913a3494461262f35a33c775bc781bf8493811498c98d928"
string(8) "sha3-256"
string(64) "0af6713adaaf3d9318aa88ffcb9265bf1e32208c1bb28e49b278e16827a99b17"
string(64) "0af6713adaaf3d9318aa88ffcb9265bf1e32208c1bb28e49b278e16827a99b17"
string(8) "sha3-384"
string(96) "0300ed595b48b9e6906b8a181a5bdd3dfaef45d057f9658b89caeb9f31f81d96428394eecb60d4c48dbb54fe3966741f"
string(96) "0300ed595b48b9e6906b8a181a5bdd3dfaef45d057f9658b89caeb9f31f81d96428394eecb60d4c48dbb54fe3966741f"
string(8) "sha3-512"
string(128) "a860b5b19649c05fd11dbeabda6ebfd2d020ece3e7eefd0502cdd39a2db6301431c53d5fba469e7d573cb836394141615b2b58fe059f1135e328b599fbda462b"
string(128) "a860b5b19649c05fd11dbeabda6ebfd2d020ece3e7eefd0502cdd39a2db6301431c53d5fba469e7d573cb836394141615b2b58fe059f1135e328b599fbda462b"
string(9) "ripemd128"
string(32) "07b00fd7a7e2e546266f7521811e1dba"
string(32) "07b00fd7a7e2e546266f7521811e1dba"
string(9) "ripemd160"
string(40) "0f4e06f78472b551d7c970c7b2ace3bb5c7a1456"
string(40) "0f4e06f78472b551d7c970c7b2ace3bb5c7a1456"
string(9) "ripemd256"
string(64) "0015009b7fc137d8fd33c96ce016e686c70edbeaa4438d524ad30e1265365079"
string(64) "0015009b7fc137d8fd33c96ce016e686c70edbeaa4438d524ad30e1265365079"
string(9) "ripemd320"
string(80) "e8b307c85b2536d564a3fcd12d30f217706eb77f706d6970025a9b430f76bc566dec2216428aa717"
string(80) "e8b307c85b2536d564a3fcd12d30f217706eb77f706d6970025a9b430f76bc566dec2216428aa717"
string(9) "whirlpool"
string(128) "b94ff2f4468947d906574c72ce4bf41b3f19d6dba35567035e5b3f06ae3ca4dae0cffe8b138a51fb5f195106dd9ab414ee4125712716041f9d3c60d3556a4a1c"
string(128) "b94ff2f4468947d906574c72ce4bf41b3f19d6dba35567035e5b3f06ae3ca4dae0cffe8b138a51fb5f195106dd9ab414ee4125712716041f9d3c60d3556a4a1c"
string(10) "tiger128,3"
string(32) "797fe17fd0b8186f75b712f61027da2a"
string(32) "797fe17fd0b8186f75b712f61027da2a"
string(10) "tiger160,3"
string(40) "6c37c331d6d9224c2880e97b9141c01100ae08f8"
string(40) "6c37c331d6d9224c2880e97b9141c01100ae08f8"
string(10) "tiger192,3"
string(48) "0fbf0eb2899b4947b228de7bac688361031a77c32d0901f9"
string(48) "0fbf0eb2899b4947b228de7bac688361031a77c32d0901f9"
string(10) "tiger128,4"
string(32) "ef8441dd4dc50bbd2e1df22b21a19d37"
string(32) "ef8441dd4dc50bbd2e1df22b21a19d37"
string(10) "tiger160,4"
string(40) "b86e995ae25d41e70420b81bfbc81eedcc34f987"
string(40) "b86e995ae25d41e70420b81bfbc81eedcc34f987"
string(10) "tiger192,4"
string(48) "2746f21e1e9dbe6e330c5ac6bccec6d2971283333604d08a"
string(48) "2746f21e1e9dbe6e330c5ac6bccec6d2971283333604d08a"
string(6) "snefru"
string(64) "7c62273e38011e85b3d55c501dc81d4c24f262ba6c294502efa1b2357dc6d030"
string(64) "7c62273e38011e85b3d55c501dc81d4c24f262ba6c294502efa1b2357dc6d030"
string(9) "snefru256"
string(64) "7c62273e38011e85b3d55c501dc81d4c24f262ba6c294502efa1b2357dc6d030"
string(64) "7c62273e38011e85b3d55c501dc81d4c24f262ba6c294502efa1b2357dc6d030"
string(4) "gost"
string(64) "73004157d477cc2ffe45a7fe5d426f07b16947d63cb395f52a67c9fee3ef89ec"
string(64) "73004157d477cc2ffe45a7fe5d426f07b16947d63cb395f52a67c9fee3ef89ec"
string(11) "gost-crypto"
string(64) "42cc6f8aeb1e5eb9cf32e558d2cb0c894a0eadbfd2af38dc2611740435179b9e"
string(64) "42cc6f8aeb1e5eb9cf32e558d2cb0c894a0eadbfd2af38dc2611740435179b9e"
string(10) "haval128,3"
string(32) "d334307f5c862d8950f36876a370f824"
string(32) "d334307f5c862d8950f36876a370f824"
string(10) "haval160,3"
string(40) "294534879be8524d74d60258d3364fbf9e701dd5"
string(40) "294534879be8524d74d60258d3364fbf9e701dd5"
string(10) "haval192,3"
string(48) "63f79d78c0964a237057f5ed6089a376eaf68580150d925a"
string(48) "63f79d78c0964a237057f5ed6089a376eaf68580150d925a"
string(10) "haval224,3"
string(56) "c1d2511ec1d9c142b68a577c5e67052a509c7c3de4b6450dcd7d5809"
string(56) "c1d2511ec1d9c142b68a577c5e67052a509c7c3de4b6450dcd7d5809"
string(10) "haval256,3"
string(64) "78bc7ed1c76f6818be3765bf9fa0b5ee10bf50bbdcafe061e2fb8239d9873552"
string(64) "78bc7ed1c76f6818be3765bf9fa0b5ee10bf50bbdcafe061e2fb8239d9873552"
string(10) "haval128,4"
string(32) "2794efe853e110d5f762c0b2702f6c2b"
string(32) "2794efe853e110d5f762c0b2702f6c2b"
string(10) "haval160,4"
string(40) "b559a2f173cdf16477421643ddb01fdc1bb3c12b"
string(40) "b559a2f173cdf16477421643ddb01fdc1bb3c12b"
string(10) "haval192,4"
string(48) "71b1f627f5a0d74cd36bf21e32c39fa47f0abef40bdff7f5"
string(48) "71b1f627f5a0d74cd36bf21e32c39fa47f0abef40bdff7f5"
string(10) "haval224,4"
string(56) "deb3e29ff4dab79d4fbcb879ba97f7889368c99aadef9b3d31c89681"
string(56) "deb3e29ff4dab79d4fbcb879ba97f7889368c99aadef9b3d31c89681"
string(10) "haval256,4"
string(64) "3aeb83f4e305db389457489c12c8acfc9d706ae9d112aa34d0334d3865cb6220"
string(64) "3aeb83f4e305db389457489c12c8acfc9d706ae9d112aa34d0334d3865cb6220"
string(10) "haval128,5"
string(32) "ae112ca08eabd55534139115776886c7"
string(32) "ae112ca08eabd55534139115776886c7"
string(10) "haval160,5"
string(40) "84201a45ec1376b13f17e3e0d29d4253948d0be3"
string(40) "84201a45ec1376b13f17e3e0d29d4253948d0be3"
string(10) "haval192,5"
string(48) "57856b379cdb1d71ab7896bc12040ad3d00ee95424591a11"
string(48) "57856b379cdb1d71ab7896bc12040ad3d00ee95424591a11"
string(10) "haval224,5"
string(56) "63b19d6f5a906f9b59d45d837fa0950101651758fd0638559f6e3dcc"
string(56) "63b19d6f5a906f9b59d45d837fa0950101651758fd0638559f6e3dcc"
string(10) "haval256,5"
string(64) "7e26f27a0786e4da8940d4c76eaf1c98b72db7b059a4c80e364b3157ac9df2e5"
string(64) "7e26f27a0786e4da8940d4c76eaf1c98b72db7b059a4c80e364b3157ac9df2e5"
string(3) "md2"
string(32) "b9c02deff635521703c1591229e81bf4"
string(32) "b9c02deff635521703c1591229e81bf4"
string(3) "md4"
string(32) "712efcc21c8f7a8aa87b9711a5be2140"
string(32) "712efcc21c8f7a8aa87b9711a5be2140"
string(3) "md5"
string(32) "fe6a08d174310341652bd86b8231c034"
string(32) "fe6a08d174310341652bd86b8231c034"
string(4) "sha1"
string(40) "52a74670f75f91168f146d31dbe8baee3d44458a"
string(40) "52a74670f75f91168f146d31dbe8baee3d44458a"
string(6) "sha224"
string(56) "ff62de7597dd265b32ec96f03b0b0f7056100dbdec0d576331eeab78"
string(56) "ff62de7597dd265b32ec96f03b0b0f7056100dbdec0d576331eeab78"
string(6) "sha256"
string(64) "22ff0093d2f85b1123636a888ca478bc62dce8bb97d4551bf5fe26947fe4b6ca"
string(64) "22ff0093d2f85b1123636a888ca478bc62dce8bb97d4551bf5fe26947fe4b6ca"
string(6) "sha384"
string(96) "ec622ccf9618c403ae3f4fae413a983f2a9ea0b01f9f3a4d2f814dd3514b3925be2af449b3d833baf6af9425c61ced3a"
string(96) "ec622ccf9618c403ae3f4fae413a983f2a9ea0b01f9f3a4d2f814dd3514b3925be2af449b3d833baf6af9425c61ced3a"
string(10) "sha512/224"
string(56) "681b976563df90c1c60d1ceca9f9303f6a4deabde3f995c3ede0acf1"
string(56) "681b976563df90c1c60d1ceca9f9303f6a4deabde3f995c3ede0acf1"
string(10) "sha512/256"
string(64) "a8aa140736b5583c3856706f980cfb7455fb65da4d145fab45e7b91fecaeefa3"
string(64) "a8aa140736b5583c3856706f980cfb7455fb65da4d145fab45e7b91fecaeefa3"
string(6) "sha512"
string(128) "b874aa107393e072b93c2cf9b3fd4ed2f9789f375b2271bca1dbadb365b67b06315110f3ed41edb44ebd36bcd2c14793e4b008abf641f7b91881bb0f6b47d854"
string(128) "b874aa107393e072b93c2cf9b3fd4ed2f9789f375b2271bca1dbadb365b67b06315110f3ed41edb44ebd36bcd2c14793e4b008abf641f7b91881bb0f6b47d854"
string(8) "sha3-224"
string(56) "80909affa80e51a0731831d790121e585cbf480a5d8293994e956273"
string(56) "80909affa80e51a0731831d790121e585cbf480a5d8293994e956273"
string(8) "sha3-256"
string(64) "33b803b02201a82d8e8872a65928fbbc179b8a003bed604384abaa3d7e651b47"
string(64) "33b803b02201a82d8e8872a65928fbbc179b8a003bed604384abaa3d7e651b47"
string(8) "sha3-384"
string(96) "630076478d5239c5536b28c82a7dd8780ae6e643c1052a0325fc5ce95fb186a354830bb8c9b5b57e0a0fbbdb6c59c240"
string(96) "630076478d5239c5536b28c82a7dd8780ae6e643c1052a0325fc5ce95fb186a354830bb8c9b5b57e0a0fbbdb6c59c240"
string(8) "sha3-512"
string(128) "7d45748f915cd5a8151f19f36e5de8d34abd86e62ea09259ef0cc4dac1c558b42e837e84716e0ea72257b396ea79a3a457bfdbac219ca899686adad0f01ebcd9"
string(128) "7d45748f915cd5a8151f19f36e5de8d34abd86e62ea09259ef0cc4dac1c558b42e837e84716e0ea72257b396ea79a3a457bfdbac219ca899686adad0f01ebcd9"
string(9) "ripemd128"
string(32) "50fcb2dce3c1b113e12313a01742e3d6"
string(32) "50fcb2dce3c1b113e12313a01742e3d6"
string(9) "ripemd160"
string(40) "0c22c893a59e0b862f75b8450bdcfb591d6704ea"
string(40) "0c22c893a59e0b862f75b8450bdcfb591d6704ea"
string(9) "ripemd256"
string(64) "0b3c19b3b4ec2459b2cf32117dd4a4487c3bb5ed87c2282da520d9dd7e0556ce"
string(64) "0b3c19b3b4ec2459b2cf32117dd4a4487c3bb5ed87c2282da520d9dd7e0556ce"
string(9) "ripemd320"
string(80) "b08a15d6aff570e25432a956dbf7350db667827030390694be67db438a396861cc4edb7233baeb70"
string(80) "b08a15d6aff570e25432a956dbf7350db667827030390694be67db438a396861cc4edb7233baeb70"
string(9) "whirlpool"
string(128) "dca5216c63bae290e9172c04c5c7dc8f4b1480bbe78160a1a386fbe130463e6b613f154df16e01568da636a86d89e8becbc95cb09f178fe829e1eb8ab031b0db"
string(128) "dca5216c63bae290e9172c04c5c7dc8f4b1480bbe78160a1a386fbe130463e6b613f154df16e01568da636a86d89e8becbc95cb09f178fe829e1eb8ab031b0db"
string(10) "tiger128,3"
string(32) "dd1a7be55bc16845f7895676bcbfc439"
string(32) "dd1a7be55bc16845f7895676bcbfc439"
string(10) "tiger160,3"
string(40) "f62760a441d63251cf1951a27b1c5a7b6155f937"
string(40) "f62760a441d63251cf1951a27b1c5a7b6155f937"
string(10) "tiger192,3"
string(48) "68541e2026bdc572a05a232f44fc365b1aa30ed99e140bdb"
string(48) "68541e2026bdc572a05a232f44fc365b1aa30ed99e140bdb"
string(10) "tiger128,4"
string(32) "7b747a53b9ab46d965d3542c05456dcd"
string(32) "7b747a53b9ab46d965d3542c05456dcd"
string(10) "tiger160,4"
string(40) "33593f34a73f02acb693b2cac3dbd028aebfe7ca"
string(40) "33593f34a73f02acb693b2cac3dbd028aebfe7ca"
string(10) "tiger192,4"
string(48) "cd98a11be78ff42832133dd7ae77957f1ae84e7f83812fde"
string(48) "cd98a11be78ff42832133dd7ae77957f1ae84e7f83812fde"
string(6) "snefru"
string(64) "8fec55eaab121c3fe62cf728bbf435eb0b3250fe843b2a730f0527cf6d20d95c"
string(64) "8fec55eaab121c3fe62cf728bbf435eb0b3250fe843b2a730f0527cf6d20d95c"
string(9) "snefru256"
string(64) "8fec55eaab121c3fe62cf728bbf435eb0b3250fe843b2a730f0527cf6d20d95c"
string(64) "8fec55eaab121c3fe62cf728bbf435eb0b3250fe843b2a730f0527cf6d20d95c"
string(4) "gost"
string(64) "222b106459ebee58e9ccc5774370bfe466cd122b0676ba30573200e07b9113b9"
string(64) "222b106459ebee58e9ccc5774370bfe466cd122b0676ba30573200e07b9113b9"
string(11) "gost-crypto"
string(64) "2264f6d9019f7581437828e79840970db37a9b7e548f9cbd57477aee2b70e36f"
string(64) "2264f6d9019f7581437828e79840970db37a9b7e548f9cbd57477aee2b70e36f"
string(10) "haval128,3"
string(32) "35746b7b22adb46600ce302f26911bce"
string(32) "35746b7b22adb46600ce302f26911bce"
string(10) "haval160,3"
string(40) "ab27fd1086dd64d64792befa6783f00126418353"
string(40) "ab27fd1086dd64d64792befa6783f00126418353"
string(10) "haval192,3"
string(48) "28010a29df3e8bda547d2808d14f1aa2da24e984892d3617"
string(48) "28010a29df3e8bda547d2808d14f1aa2da24e984892d3617"
string(10) "haval224,3"
string(56) "e73eed383823ddceb241800a6d86db289b664b3e7158e8cb225b959a"
string(56) "e73eed383823ddceb241800a6d86db289b664b3e7158e8cb225b959a"
string(10) "haval256,3"
string(64) "fd151d44cf5210164066d285dafa460520f020135ea4943e2ea797021d48a8c6"
string(64) "fd151d44cf5210164066d285dafa460520f020135ea4943e2ea797021d48a8c6"
string(10) "haval128,4"
string(32) "13e17f44830fdbfd87008c7b77f06b1e"
string(32) "13e17f44830fdbfd87008c7b77f06b1e"
string(10) "haval160,4"
string(40) "d3954bf1bc467e637e9cf6b1f845a7bb700e94e3"
string(40) "d3954bf1bc467e637e9cf6b1f845a7bb700e94e3"
string(10) "haval192,4"
string(48) "d2c370470da8eab5ccbdc4e73a515fce0968251b921b7c17"
string(48) "d2c370470da8eab5ccbdc4e73a515fce0968251b921b7c17"
string(10) "haval224,4"
string(56) "177fa8ea821ceb701ae676db3b1f154669e63fb191281474954ae660"
string(56) "177fa8ea821ceb701ae676db3b1f154669e63fb191281474954ae660"
string(10) "haval256,4"
string(64) "7c7ea5335dd023569d3c7811edea5d1f35ed64864c2799d37e9d064ec5353e74"
string(64) "7c7ea5335dd023569d3c7811edea5d1f35ed64864c2799d37e9d064ec5353e74"
string(10) "haval128,5"
string(32) "35f814eb0f0a1dfdac97463cd3719f4b"
string(32) "35f814eb0f0a1dfdac97463cd3719f4b"
string(10) "haval160,5"
string(40) "c9200eea73b44861aed32aa98d7cb010ea77ecd8"
string(40) "c9200eea73b44861aed32aa98d7cb010ea77ecd8"
string(10) "haval192,5"
string(48) "9491e6023235d1956aaef3db55bef6cfdc31b4751a5e0c9a"
string(48) "9491e6023235d1956aaef3db55bef6cfdc31b4751a5e0c9a"
string(10) "haval224,5"
string(56) "b3afcae286992bb699946dc6c741e66f39346bfb01f01973a2fd1225"
string(56) "b3afcae286992bb699946dc6c741e66f39346bfb01f01973a2fd1225"
string(10) "haval256,5"
string(64) "d42d7f9bc59718a516be641f5fa53e0c6ad9627812f9a40cc18f63ba3d73ef4c"
string(64) "d42d7f9bc59718a516be641f5fa53e0c6ad9627812f9a40cc18f63ba3d73ef4c"
Done
